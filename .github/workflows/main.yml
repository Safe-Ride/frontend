name: Send Email on Commit

on:
  push:

jobs:
  send-email:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Send email notification via SendGrid using curl
        env:
          SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}  # Defina a chave API do SendGrid como segredo no GitHub
          COMMIT_AUTHOR_EMAIL: ${{ github.event.head_commit.author.email }}
          COMMIT_AUTHOR_NAME: ${{ github.event.head_commit.author.name }}

        run: |
          # Corpo do e-mail em formato JSON
          EMAIL_PAYLOAD=$(cat <<EOF
          {
            "personalizations": [
              {
                "to": [
                  {
                    "email": "$COMMIT_AUTHOR_EMAIL"
                  }
                ],
                "subject": "âš ï¸ Lembrete de RelatÃ³rio de produtividade âš ï¸"
              }
            ],
            "from": {
              "email": "safe20.ride24@gmail.com"
            },
            "content": [
              {
                "type": "text/plain",
                "value": "OlÃ¡, $COMMIT_AUTHOR_NAME.\n\nVocÃª acabou de fazer um commit no repositÃ³rio.\nNÃ£o se esqueÃ§a de fazer o relatÃ³rio de produtividade para nÃ£o ter problemas com apontamentos e acumular faltas em PI.\n\nðŸš¨ AtenÃ§Ã£o ðŸš¨"
              }
            ]
          }
          EOF
          )

          # Comando curl para enviar o e-mail usando a API do SendGrid
          curl --request POST \
            --url https://api.sendgrid.com/v3/mail/send \
            --header "Authorization: Bearer $SENDGRID_API_KEY" \
            --header 'Content-Type: application/json' \
            --data "$EMAIL_PAYLOAD"
